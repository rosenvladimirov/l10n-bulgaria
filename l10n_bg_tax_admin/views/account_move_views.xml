<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_move_form" model="ir.ui.view">
            <field name="name">account.move.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <!-- Protocol-->
                    <button name="action_protocol" string='View Protocol'
                            type='action' groups="account.group_account_invoice"
                            context="{'search_default_move_id': [active_id]}"
                            data-hotkey='r'
                            attrs="{'invisible': ['!', ('type_vat', '=', '117_protocol'), ('state', '!=', 'posted')]}"/>
                    <!-- Customs-->
                    <button name="action_customs" string='Customs'
                            type='action' groups="account.group_account_invoice"
                            context="{'search_default_customs_invoice_id': [active_id]}"
                            data-hotkey='r'
                            attrs="{'invisible': ['!', ('type_vat', 'in', 'in_customs'), ('state', '!=', 'posted')]}"/>
                </xpath>

                <xpath expr="//notebook/page[@id='invoice_tab']" position="after">
                    <page id="customs_tab" name="customs_tab" string="Customs invoices" attrs="{'invisible': [('type_vat', 'not in', ['in_customs', 'out_customs'])]}">
                        <group>
                            <group>
                                <field name="customs_invoice_ids" widget="many2many_tags"/>
                            </group>
                            <group>
                                <field name="customs_date"/>
                            </group>
                        </group>
                        <field name="customs_line_ids" readonly="1">
                            <tree string="Invoice lines">
                                <field name="product_id"
                                       optional="show"
                                       widget="many2one_barcode"
                                       domain="
                                            context.get('default_move_type') in ('out_invoice', 'out_refund', 'out_receipt')
                                            and [('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]
                                            or [('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]
                                       "/>
                                <field name="name" widget="section_and_note_text" optional="show"/>
                                <field name="account_id"
                                               context="{'partner_id': partner_id, 'move_type': parent.move_type}"
                                               groups="account.group_account_readonly"
                                               options="{'no_create': True}"
                                               domain="[('deprecated', '=', False), ('account_type', 'not in', ('asset_receivable', 'liability_payable')), ('company_id', '=', parent.company_id), ('is_off_balance', '=', False)]"
                                               attrs="{'required': [('display_type', 'not in', ('line_note', 'line_section'))]}"/>
                                <field name="analytic_distribution" widget="analytic_distribution"
                                       groups="analytic.group_analytic_accounting"
                                       optional="show"
                                       options="{'product_field': 'product_id', 'account_field': 'account_id'}"/>
                                <field name="quantity" optional="show"/>
                                <field name="product_uom_category_id" invisible="1"/>
                                <field name="product_uom_id" string="UoM" groups="uom.group_uom" optional="show"/>
                                <field name="price_unit" string="Price"/>
                                <field name="discount" string="Disc.%" optional="hide"/>
                                <field name="tax_ids" widget="many2many_tags"
                                       domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain), ('company_id', '=', parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                       context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain}"
                                       options="{'no_create': True}"
                                       optional="show"/>
                                <field name="price_subtotal"
                                       string="Subtotal"
                                       groups="account.group_show_line_subtotals_tax_excluded"/>
                                <field name="price_total"
                                       string="Total"
                                       groups="account.group_show_line_subtotals_tax_included"/>

                                <!-- Others fields -->
                                <field name="partner_id" invisible="1"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="company_id" invisible="1"/>
                                <field name="company_currency_id" invisible="1"/>
                                <field name="display_type" force_save="1" invisible="1"/>
                                <!-- /l10n_in_edi.test_edi_json -->
                                <!-- required for @api.onchange('product_id') -->
                                <field name="product_uom_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//field[@name='quick_encoding_vals']" position="after">
                    <field name="protocol_date" invisible="1"/>
                    <field name="protocol_line_ids" invisible="1"/>
                    <field name="type_vat" invisible="1"/>
                </xpath>
                <xpath expr="//group[@id='other_tab_group']" position="inside">
                    <group string="Bulgarian VAT"
                           name="account_bg_vat"
                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}">
                        <field name="doc_type"/>
                        <field name="name_bg_second" attrs="{'invisible': [('type_vat', '=', 'standard')]}"/>
                    </group>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
